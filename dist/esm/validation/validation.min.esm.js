"use strict";var __createBinding=Object.create?function(r,t,e,a){void 0===a&&(a=e),Object.defineProperty(r,a,{enumerable:!0,get:function(){return t[e]}})}:function(r,t,e,a){r[a=void 0===a?e:a]=t[e]},__setModuleDefault=Object.create?function(r,t){Object.defineProperty(r,"default",{enumerable:!0,value:t})}:function(r,t){r.default=t},__importStar=function(r){if(r&&r.__esModule)return r;var t={};if(null!=r)for(var e in r)"default"!==e&&Object.prototype.hasOwnProperty.call(r,e)&&__createBinding(t,r,e);return __setModuleDefault(t,r),t},__spreadArray=function(r,t){for(var e=0,a=t.length,o=r.length;e<a;e++,o++)r[o]=t[e];return r},__importDefault=function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.validate=exports.ValidatorRegistry=void 0;var utils_1=require("../utils"),Validators=__importStar(require("./Validators")),constants_1=require("./constants"),Validator_1=__importDefault(require("./Validators/Validator"));function ValRegistry(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var e=new function(){var e={};this.register=function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];r.forEach(function(r){r instanceof Validator_1.default?e[r.validationKey]=r:(r=new(r.default||r),e[r.validationKey]=r)})},this.getValidator=function(r){if(r in e)return e[r]}};return e.register.apply(e,r),e}function validate(i){var r,t=[];for(r in i)i.hasOwnProperty(r)&&t.push(utils_1.getPropertyDecorators(constants_1.ValidationKeys.REFLECT,i,r));return t.reduce(function(r,a){var o=a.prop,t=a.decorators;if(!t||!t.length)return r;t=t.reduce(function(r,t){var e=exports.ValidatorRegistry.getValidator(t.key);if(!e)throw new Error("Could not find Matching validator for "+t.key+" for property "+String(a.prop));e=e.hasErrors.apply(e,__spreadArray([i[o]],Object.values(t.props)));return e&&((r=r||{})[t.key]=e),r},void 0);return t&&(t={property:a.prop,errors:t},(r=r||[]).push(t)),r},void 0)}exports.ValidatorRegistry=ValRegistry.apply(void 0,Object.values(Validators)),exports.validate=validate;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZhbGlkYXRpb24vdmFsaWRhdGlvbi5qcyIsInZhbGlkYXRpb24vdmFsaWRhdGlvbi50cyJdLCJuYW1lcyI6WyJfX2NyZWF0ZUJpbmRpbmciLCJPYmplY3QiLCJjcmVhdGUiLCJvIiwibSIsImsiLCJrMiIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInVuZGVmaW5lZCIsIl9fc2V0TW9kdWxlRGVmYXVsdCIsInYiLCJ2YWx1ZSIsIl9faW1wb3J0U3RhciIsIm1vZCIsIl9fZXNNb2R1bGUiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyZXN1bHQiLCJfX3NwcmVhZEFycmF5IiwidG8iLCJmcm9tIiwiaSIsImlsIiwibGVuZ3RoIiwiaiIsIl9faW1wb3J0RGVmYXVsdCIsImRlZmF1bHQiLCJleHBvcnRzIiwidmFsaWRhdGUiLCJWYWxpZGF0b3JSZWdpc3RyeSIsInV0aWxzXzEiLCJyZXF1aXJlIiwiVmFsaWRhdG9ycyIsImNvbnN0YW50c18xIiwiVmFsaWRhdG9yXzEiLCJWYWxSZWdpc3RyeSIsImluaXRpYWwiLCJfaSIsImFyZ3VtZW50cyIsInJlZ2lzdHJ5IiwiY2FjaGUiLCJ0aGlzIiwicmVnaXN0ZXIiLCJ2YWxpZGF0b3IiLCJmb3JFYWNoIiwidmFsaWRhdGlvbktleSIsImluc3RhbmNlIiwiZ2V0VmFsaWRhdG9yIiwidmFsaWRhdG9yS2V5IiwiYXBwbHkiLCJvYmoiLCJwcm9wIiwiZGVjb3JhdGVkUHJvcGVydGllcyIsInB1c2giLCJnZXRQcm9wZXJ0eURlY29yYXRvcnMiLCJWYWxpZGF0aW9uS2V5cyIsIlJFRkxFQ1QiLCJyZWR1Y2UiLCJhY2N1bSIsImRlY29yYXRlZFByb3BlcnR5IiwiZGVjb3JhdG9ycyIsImVycnMiLCJhY2MiLCJkZWNvcmF0b3IiLCJrZXkiLCJFcnJvciIsIlN0cmluZyIsImVyciIsImhhc0Vycm9ycyIsInZhbHVlcyIsInByb3BzIiwicHJvcEVycm9ycyIsInByb3BlcnR5IiwiZXJy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SUFBS3JCLEVBQ0QsTUFBTSxJQUFJc0IsTUFBTSx5Q0FBeUNGLEVBQVVDLElBQUcsaUJBQWlCRSxPQUFPUCxFQUFrQlIsT0FJOUdnQixFQUFNeEIsRUFBVXlCLFVBQVNuQixNQUFuQk4sRUFBU3pCLGNBQUEsQ0FBV2dDLEVBQUlDLElBQVVyRCxPQUFPdUUsT0FBT04sRUFBVU8sU0FRdEUsT0FQSUgsS0FFQUwsRUFBTUEsR0FBTyxJQUVUQyxFQUFVQyxLQUFPRyxHQUdsQkwsUUFDUnZELEdBYUgsT0FYSXNELElBQ01VLEVBQWEsQ0FDZkMsU0FBVWIsRUFBa0JSLEtBQzVCc0IsT0FBUVosSUFHWkgsRUFBUUEsR0FBUyxJQUVYTCxLQUFLa0IsSUFHUmIsUUFDUm5ELEdBaERNb0IsUUFBQUUsa0JBQW9CTSxZQUFXYyxXQUFBLEVBQUluRCxPQUFPdUUsT0FBT3JDLGFBTzlETCxRQUFBQyxTQUFBQSIsImZpbGUiOiJ2YWxpZGF0aW9uL3ZhbGlkYXRpb24ubWluLmVzbS5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xudmFyIF9fY3JlYXRlQmluZGluZyA9ICh0aGlzICYmIHRoaXMuX19jcmVhdGVCaW5kaW5nKSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH0pO1xufSkgOiAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIG9bazJdID0gbVtrXTtcbn0pKTtcbnZhciBfX3NldE1vZHVsZURlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9fc2V0TW9kdWxlRGVmYXVsdCkgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgdikge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICAgIG9bXCJkZWZhdWx0XCJdID0gdjtcbn0pO1xudmFyIF9faW1wb3J0U3RhciA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnRTdGFyKSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgaWYgKG1vZCAhPSBudWxsKSBmb3IgKHZhciBrIGluIG1vZCkgaWYgKGsgIT09IFwiZGVmYXVsdFwiICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChtb2QsIGspKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGspO1xuICAgIF9fc2V0TW9kdWxlRGVmYXVsdChyZXN1bHQsIG1vZCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG52YXIgX19zcHJlYWRBcnJheSA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheSkgfHwgZnVuY3Rpb24gKHRvLCBmcm9tKSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIGlsID0gZnJvbS5sZW5ndGgsIGogPSB0by5sZW5ndGg7IGkgPCBpbDsgaSsrLCBqKyspXG4gICAgICAgIHRvW2pdID0gZnJvbVtpXTtcbiAgICByZXR1cm4gdG87XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy52YWxpZGF0ZSA9IGV4cG9ydHMuVmFsaWRhdG9yUmVnaXN0cnkgPSB2b2lkIDA7XG52YXIgdXRpbHNfMSA9IHJlcXVpcmUoXCIuLi91dGlsc1wiKTtcbnZhciBWYWxpZGF0b3JzID0gX19pbXBvcnRTdGFyKHJlcXVpcmUoXCIuL1ZhbGlkYXRvcnNcIikpO1xudmFyIGNvbnN0YW50c18xID0gcmVxdWlyZShcIi4vY29uc3RhbnRzXCIpO1xudmFyIFZhbGlkYXRvcl8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuL1ZhbGlkYXRvcnMvVmFsaWRhdG9yXCIpKTtcbmZ1bmN0aW9uIFZhbFJlZ2lzdHJ5KCkge1xuICAgIHZhciBpbml0aWFsID0gW107XG4gICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgaW5pdGlhbFtfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgIH1cbiAgICB2YXIgcmVnaXN0cnkgPSBuZXcgZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY2FjaGUgPSB7fTtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICBzZWxmLnJlZ2lzdGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIHZhbGlkYXRvciA9IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgICAgICB2YWxpZGF0b3JbX2ldID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhbGlkYXRvci5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7XG4gICAgICAgICAgICAgICAgaWYgKHYgaW5zdGFuY2VvZiBWYWxpZGF0b3JfMS5kZWZhdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlW3YudmFsaWRhdGlvbktleV0gPSB2O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnN0cnVjdG9yTWV0aG9kID0gdi5kZWZhdWx0IHx8IHY7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpbnN0YW5jZSA9IG5ldyBjb25zdHJ1Y3Rvck1ldGhvZCgpO1xuICAgICAgICAgICAgICAgICAgICBjYWNoZVtpbnN0YW5jZS52YWxpZGF0aW9uS2V5XSA9IGluc3RhbmNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBzZWxmLmdldFZhbGlkYXRvciA9IGZ1bmN0aW9uICh2YWxpZGF0b3JLZXkpIHtcbiAgICAgICAgICAgIGlmICghKHZhbGlkYXRvcktleSBpbiBjYWNoZSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgcmV0dXJuIGNhY2hlW3ZhbGlkYXRvcktleV07XG4gICAgICAgIH07XG4gICAgfSgpO1xuICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyLmFwcGx5KHJlZ2lzdHJ5LCBpbml0aWFsKTtcbiAgICByZXR1cm4gcmVnaXN0cnk7XG59XG5leHBvcnRzLlZhbGlkYXRvclJlZ2lzdHJ5ID0gVmFsUmVnaXN0cnkuYXBwbHkodm9pZCAwLCBPYmplY3QudmFsdWVzKFZhbGlkYXRvcnMpKTtcbmZ1bmN0aW9uIHZhbGlkYXRlKG9iaikge1xuICAgIHZhciBkZWNvcmF0ZWRQcm9wZXJ0aWVzID0gW107XG4gICAgZm9yICh2YXIgcHJvcCBpbiBvYmopXG4gICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkocHJvcCkpXG4gICAgICAgICAgICBkZWNvcmF0ZWRQcm9wZXJ0aWVzLnB1c2godXRpbHNfMS5nZXRQcm9wZXJ0eURlY29yYXRvcnMoY29uc3RhbnRzXzEuVmFsaWRhdGlvbktleXMuUkVGTEVDVCwgb2JqLCBwcm9wKSk7XG4gICAgcmV0dXJuIGRlY29yYXRlZFByb3BlcnRpZXMucmVkdWNlKGZ1bmN0aW9uIChhY2N1bSwgZGVjb3JhdGVkUHJvcGVydHkpIHtcbiAgICAgICAgdmFyIHByb3AgPSBkZWNvcmF0ZWRQcm9wZXJ0eS5wcm9wLCBkZWNvcmF0b3JzID0gZGVjb3JhdGVkUHJvcGVydHkuZGVjb3JhdG9ycztcbiAgICAgICAgaWYgKCFkZWNvcmF0b3JzIHx8ICFkZWNvcmF0b3JzLmxlbmd0aClcbiAgICAgICAgICAgIHJldHVybiBhY2N1bTtcbiAgICAgICAgdmFyIGVycnMgPSBkZWNvcmF0b3JzLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBkZWNvcmF0b3IpIHtcbiAgICAgICAgICAgIHZhciB2YWxpZGF0b3IgPSBleHBvcnRzLlZhbGlkYXRvclJlZ2lzdHJ5LmdldFZhbGlkYXRvcihkZWNvcmF0b3Iua2V5KTtcbiAgICAgICAgICAgIGlmICghdmFsaWRhdG9yKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGZpbmQgTWF0Y2hpbmcgdmFsaWRhdG9yIGZvciBcIiArIGRlY29yYXRvci5rZXkgKyBcIiBmb3IgcHJvcGVydHkgXCIgKyBTdHJpbmcoZGVjb3JhdGVkUHJvcGVydHkucHJvcCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGVyciA9IHZhbGlkYXRvci5oYXNFcnJvcnMuYXBwbHkodmFsaWRhdG9yLCBfX3NwcmVhZEFycmF5KFtvYmpbcHJvcF1dLCBPYmplY3QudmFsdWVzKGRlY29yYXRvci5wcm9wcykpKTtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICBhY2MgPSBhY2MgfHwge307XG4gICAgICAgICAgICAgICAgYWNjW2RlY29yYXRvci5rZXldID0gZXJyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgfSwgdW5kZWZpbmVkKTtcbiAgICAgICAgaWYgKGVycnMpIHtcbiAgICAgICAgICAgIHZhciBwcm9wRXJyb3JzID0ge1xuICAgICAgICAgICAgICAgIHByb3BlcnR5OiBkZWNvcmF0ZWRQcm9wZXJ0eS5wcm9wLFxuICAgICAgICAgICAgICAgIGVycm9yczogZXJyc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGFjY3VtID0gYWNjdW0gfHwgW107XG4gICAgICAgICAgICBhY2N1bS5wdXNoKHByb3BFcnJvcnMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBhY2N1bTtcbiAgICB9LCB1bmRlZmluZWQpO1xufVxuZXhwb3J0cy52YWxpZGF0ZSA9IHZhbGlkYXRlOyIsImltcG9ydCBNb2RlbCBmcm9tIFwiLi4vTW9kZWwvTW9kZWxcIjtcbmltcG9ydCB7RXJyb3JzLCBSZWdpc3RyeX0gZnJvbSBcIi4vdHlwZXNcIjtcbmltcG9ydCB7Z2V0UHJvcGVydHlEZWNvcmF0b3JzfSBmcm9tICcuLi91dGlscydcbmltcG9ydCAqIGFzIFZhbGlkYXRvcnMgZnJvbSAnLi9WYWxpZGF0b3JzJ1xuaW1wb3J0IHtWYWxpZGF0aW9uS2V5c30gZnJvbSBcIi4vY29uc3RhbnRzXCI7XG5pbXBvcnQgVmFsaWRhdG9yIGZyb20gXCIuL1ZhbGlkYXRvcnMvVmFsaWRhdG9yXCI7XG5cbi8qKlxuICogUmV0dXJuc1xuICogQHJldHVybiB7Kn1cbiAqIEBjb25zdHJ1Y3RvclxuICogQGZ1bmN0aW9uIFZhbFJlZ2lzdHJ5XG4gKiBAbWVtYmVyT2YgVmFsaWRhdGlvblxuICovXG5mdW5jdGlvbiBWYWxSZWdpc3RyeSguLi5pbml0aWFsOiBhbnlbXSkgOiBSZWdpc3RyeSB7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGNvbnN0IHJlZ2lzdHJ5OiBSZWdpc3RyeSA9ICBuZXcgZnVuY3Rpb24oKXtcbiAgICAgICAgY29uc3QgY2FjaGU6IGFueSA9IHt9O1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGNvbnN0IHNlbGY6IGFueSA9IHRoaXM7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB2YWxpZGF0b3JcbiAgICAgICAgICogQG1lbWJlck9mIFZhbGlkYXRvclJlZ2lzdHJ5XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLnJlZ2lzdGVyID0gZnVuY3Rpb24oLi4udmFsaWRhdG9yOiBhbnlbXSkgOiB2b2lke1xuICAgICAgICAgICAgdmFsaWRhdG9yLmZvckVhY2godiA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHYgaW5zdGFuY2VvZiBWYWxpZGF0b3Ipe1xuICAgICAgICAgICAgICAgICAgICBjYWNoZVt2LnZhbGlkYXRpb25LZXldID0gdjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbnN0cnVjdG9yTWV0aG9kID0gdi5kZWZhdWx0IHx8IHY7XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5zdGFuY2U6IFZhbGlkYXRvciA9IG5ldyBjb25zdHJ1Y3Rvck1ldGhvZCgpO1xuICAgICAgICAgICAgICAgICAgICBjYWNoZVtpbnN0YW5jZS52YWxpZGF0aW9uS2V5XSA9IGluc3RhbmNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqXG4gICAgICAgICAqIEBwYXJhbSB2YWxpZGF0b3JLZXlcbiAgICAgICAgICogQHJldHVybiB7Kn1cbiAgICAgICAgICogQG1lbWJlck9mIFZhbGlkYXRvclJlZ2lzdHJ5XG4gICAgICAgICAqL1xuICAgICAgICBzZWxmLmdldFZhbGlkYXRvciA9IGZ1bmN0aW9uKHZhbGlkYXRvcktleTogc3RyaW5nKXtcbiAgICAgICAgICAgIGlmICghKHZhbGlkYXRvcktleSBpbiBjYWNoZSkpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgcmV0dXJuIGNhY2hlW3ZhbGlkYXRvcktleV07XG4gICAgICAgIH1cbiAgICB9KClcbiAgICByZWdpc3RyeS5yZWdpc3RlciguLi5pbml0aWFsKTtcbiAgICByZXR1cm4gcmVnaXN0cnk7XG59XG5cbi8qKlxuICogQGNvbnN0YW50XG4gKiBAbWVtYmVyT2YgVmFsaWRhdGlvblxuICovXG5leHBvcnQgY29uc3QgVmFsaWRhdG9yUmVnaXN0cnkgPSBWYWxSZWdpc3RyeSguLi5PYmplY3QudmFsdWVzKFZhbGlkYXRvcnMpKTtcblxuLyoqXG4gKiBBbmFseXNlcyB0aGUgZGVjb3JhdGlvbnMgb2YgdGhlIHByb3BlcnRpZXMgYW5kIHZhbGlkYXRlcyB0aGUgb2JqIGFjY29yZGluZyB0byB0aGVtXG4gKiBAZnVuY3Rpb24gdmFsaWRhdGVcbiAqIEBtZW1iZXJPZiBWYWxpZGF0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZTxUIGV4dGVuZHMgTW9kZWw+KG9iajogVCkgOiBFcnJvcnN7XG4gICAgY29uc3QgZGVjb3JhdGVkUHJvcGVydGllcyA9IFtdO1xuICAgIGZvciAobGV0IHByb3AgaW4gb2JqKVxuICAgICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KHByb3ApKVxuICAgICAgICAgICAgZGVjb3JhdGVkUHJvcGVydGllcy5wdXNoKGdldFByb3BlcnR5RGVjb3JhdG9ycyhWYWxpZGF0aW9uS2V5cy5SRUZMRUNULCBvYmosIHByb3ApKTtcblxuICAgIHJldHVybiBkZWNvcmF0ZWRQcm9wZXJ0aWVzLnJlZHVjZSgoYWNjdW0sIGRlY29yYXRlZFByb3BlcnR5KSA9PiB7XG4gICAgICAgIGNvbnN0IHtwcm9wLCBkZWNvcmF0b3JzfSA9IGRlY29yYXRlZFByb3BlcnR5O1xuICAgICAgICBpZiAoIWRlY29yYXRvcnMgfHwgIWRlY29yYXRvcnMubGVuZ3RoKVxuICAgICAgICAgICAgcmV0dXJuIGFjY3VtO1xuXG4gICAgICAgIGNvbnN0IGVycnMgPSBkZWNvcmF0b3JzLnJlZHVjZSgoYWNjLCBkZWNvcmF0b3I6IHtrZXk6IHN0cmluZywgcHJvcHM6IHt9fSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdmFsaWRhdG9yID0gVmFsaWRhdG9yUmVnaXN0cnkuZ2V0VmFsaWRhdG9yKGRlY29yYXRvci5rZXkpO1xuICAgICAgICAgICAgaWYgKCF2YWxpZGF0b3Ipe1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGZpbmQgTWF0Y2hpbmcgdmFsaWRhdG9yIGZvciAke2RlY29yYXRvci5rZXl9IGZvciBwcm9wZXJ0eSAke1N0cmluZyhkZWNvcmF0ZWRQcm9wZXJ0eS5wcm9wKX1gKVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBjb25zdCBlcnIgPSB2YWxpZGF0b3IuaGFzRXJyb3JzKG9ialtwcm9wXSwgLi4uT2JqZWN0LnZhbHVlcyhkZWNvcmF0b3IucHJvcHMpKTtcbiAgICAgICAgICAgIGlmIChlcnIpe1xuICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICBhY2MgPSBhY2MgfHwge307XG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIGFjY1tkZWNvcmF0b3Iua2V5XSA9IGVycjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgfSwgdW5kZWZpbmVkKTtcblxuICAgICAgICBpZiAoZXJycyl7XG4gICAgICAgICAgICBjb25zdCBwcm9wRXJyb3JzID0ge1xuICAgICAgICAgICAgICAgIHByb3BlcnR5OiBkZWNvcmF0ZWRQcm9wZXJ0eS5wcm9wLFxuICAgICAgICAgICAgICAgIGVycm9yczogZXJyc1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgYWNjdW0gPSBhY2N1bSB8fCBbXTtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGFjY3VtLnB1c2gocHJvcEVycm9ycyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYWNjdW07XG4gICAgfSwgdW5kZWZpbmVkKTtcbn0iXX0=
