"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(t,r,e,a){void 0===a&&(a=e),Object.defineProperty(t,a,{enumerable:!0,get:function(){return r[e]}})}:function(t,r,e,a){t[a=void 0===a?e:a]=r[e]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(t,r){Object.defineProperty(t,"default",{enumerable:!0,value:r})}:function(t,r){t.default=r}),__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var r={};if(null!=t)for(var e in t)"default"!==e&&Object.prototype.hasOwnProperty.call(t,e)&&__createBinding(r,t,e);return __setModuleDefault(r,t),r},__spreadArray=this&&this.__spreadArray||function(t,r){for(var e=0,a=r.length,i=t.length;e<a;e++,i++)t[i]=r[e];return t},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.validate=exports.ValidatorRegistry=void 0;var utils_1=require("../utils"),Validators=__importStar(require("./Validators")),constants_1=require("./constants"),Validator_1=__importDefault(require("./Validators/Validator"));function ValRegistry(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var e=new function(){var e={};this.register=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];t.forEach(function(t){t instanceof Validator_1.default?e[t.validationKey]=t:(t=new(t.default||t),e[t.validationKey]=t)})},this.getValidator=function(t){if(t in e)return e[t]}};return e.register.apply(e,t),e}function validate(o){var t,r=[];for(t in o)o.hasOwnProperty(t)&&r.push(utils_1.getPropertyDecorators(constants_1.ValidationKeys.REFLECT,o,t));return r.reduce(function(t,a){var i=a.prop,r=a.decorators;if(!r||!r.length)return t;r=r.reduce(function(t,r){var e=exports.ValidatorRegistry.getValidator(r.key);if(!e)throw new Error("Could not find Matching validator for "+r.key+" for property "+String(a.prop));e=e.hasErrors.apply(e,__spreadArray([o[i]],Object.values(r.props)));return e&&((t=t||{})[r.key]=e),t},void 0);return r&&(r={property:a.prop,errors:r},(t=t||[]).push(r)),t},void 0)}exports.ValidatorRegistry=ValRegistry.apply(void 0,Object.values(Validators)),exports.validate=validate;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZhbGlkYXRpb24vdmFsaWRhdGlvbi5qcyIsInZhbGlkYXRpb24vdmFsaWRhdGlvbi50cyJdLCJuYW1lcyI6WyJfX2NyZWF0ZUJpbmRpbmciLCJ0aGlzIiwiT2JqZWN0IiwiY3JlYXRlIiwibyIsIm0iLCJrIiwiazIiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJ1bmRlZmluZWQiLCJfX3NldE1vZHVsZURlZmF1bHQiLCJ2IiwidmFsdWUiLCJfX2ltcG9ydFN0YXIiLCJtb2QiLCJfX2VzTW9kdWxlIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwicmVzdWx0IiwiX19zcHJlYWRBcnJheSIsInRvIiwiZnJvbSIsImkiLCJpbCIsImxlbmd0aCIsImoiLCJfX2ltcG9ydERlZmF1bHQiLCJkZWZhdWx0IiwiZXhwb3J0cyIsIlZhbGlkYXRvclJlZ2lzdHJ5IiwidXRpbHNfMSIsInJlcXVpcmUiLCJWYWxpZGF0b3JzIiwiY29uc3RhbnRzXzEiLCJWYWxpZGF0b3JfMSIsIlZhbFJlZ2lzdHJ5IiwiaW5pdGlhbCIsIl9pIiwiYXJndW1lbnRzIiwicmVnaXN0cnkiLCJjYWNoZSIsInJlZ2lzdGVyIiwidmFsaWRhdG9yIiwiZm9yRWFjaCIsInZhbGlkYXRpb25LZXkiLCJpbnN0YW5jZSIsImdldFZhbGlkYXRvciIsInZhbGlkYXRvcktleSIsImFwcGx5IiwidmFsaWRhdGUiLCJvYmoiLCJwcm9wIiwiZGVjb3JhdGVkUHJvcGVydGllcyIsInB1c2giLCJnZXRQcm9wZXJ0eURlY29yYXRvcnMiLCJWYWxpZGF0aW9uS2V5cyIsIlJFRkxFQ1QiLCJyZWR1Y2UiLCJhY2N1bSIsImRlY29yYXRlZFByb3BlcnR5IiwiZGVjb3JhdG9ycyIsImVycnMiLCJhY2MiLCJkZWNvcmF0b3IiLCJrZXkiLCJFcnJvciIsIlN0cmluZyIsImVyciIsImhhc0Vycm9ycyIsInZhbHVlcyIsInByb3BzIiwicHJvcEVycm9ycyIsInByb3BlcnR5IiwiZXJy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QyxFQUVMRyxFQUFPRCxFQUFXSCxPQUFPLFNBQUNLLEVBQUtDLEdBQ2pDLElBQU1yQixFQUFZZCxRQUFBQyxrQkFBa0JpQixhQUFhaUIsRUFBVUMsS0FDM0QsSUFBS3RCLEVBQ0QsTUFBTSxJQUFJdUIsTUFBTSx5Q0FBeUNGLEVBQVVDLElBQUcsaUJBQWlCRSxPQUFPUCxFQUFrQlIsT0FJOUdnQixFQUFNekIsRUFBVTBCLFVBQVNwQixNQUFuQk4sRUFBU3ZCLGNBQUEsQ0FBVytCLEVBQUlDLElBQVVwRCxPQUFPc0UsT0FBT04sRUFBVU8sU0FRdEUsT0FQSUgsS0FFQUwsRUFBTUEsR0FBTyxJQUVUQyxFQUFVQyxLQUFPRyxHQUdsQkwsUUFDUnRELEdBYUgsT0FYSXFELElBQ01VLEVBQWEsQ0FDZkMsU0FBVWIsRUFBa0JSLEtBQzVCc0IsT0FBUVosSUFHWkgsRUFBUUEsR0FBUyxJQUVYTCxLQUFLa0IsSUFHUmIsUUFDUmxELEdBaERNb0IsUUFBQUMsa0JBQW9CTSxZQUFXYSxXQUFBLEVBQUlqRCxPQUFPc0UsT0FBT3JDLGFBTzlESixRQUFBcUIsU0FBQUEiLCJmaWxlIjoidmFsaWRhdGlvbi92YWxpZGF0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbnZhciBfX3NwcmVhZEFycmF5ID0gKHRoaXMgJiYgdGhpcy5fX3NwcmVhZEFycmF5KSB8fCBmdW5jdGlvbiAodG8sIGZyb20pIHtcbiAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBmcm9tLmxlbmd0aCwgaiA9IHRvLmxlbmd0aDsgaSA8IGlsOyBpKyssIGorKylcbiAgICAgICAgdG9bal0gPSBmcm9tW2ldO1xuICAgIHJldHVybiB0bztcbn07XG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IFwiZGVmYXVsdFwiOiBtb2QgfTtcbn07XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnZhbGlkYXRlID0gZXhwb3J0cy5WYWxpZGF0b3JSZWdpc3RyeSA9IHZvaWQgMDtcbnZhciB1dGlsc18xID0gcmVxdWlyZShcIi4uL3V0aWxzXCIpO1xudmFyIFZhbGlkYXRvcnMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcIi4vVmFsaWRhdG9yc1wiKSk7XG52YXIgY29uc3RhbnRzXzEgPSByZXF1aXJlKFwiLi9jb25zdGFudHNcIik7XG52YXIgVmFsaWRhdG9yXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vVmFsaWRhdG9ycy9WYWxpZGF0b3JcIikpO1xuZnVuY3Rpb24gVmFsUmVnaXN0cnkoKSB7XG4gICAgdmFyIGluaXRpYWwgPSBbXTtcbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICBpbml0aWFsW19pXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgfVxuICAgIHZhciByZWdpc3RyeSA9IG5ldyBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjYWNoZSA9IHt9O1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHNlbGYucmVnaXN0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdmFsaWRhdG9yID0gW107XG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgICAgIHZhbGlkYXRvcltfaV0gPSBhcmd1bWVudHNbX2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFsaWRhdG9yLmZvckVhY2goZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICAgICAgICBpZiAodiBpbnN0YW5jZW9mIFZhbGlkYXRvcl8xLmRlZmF1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FjaGVbdi52YWxpZGF0aW9uS2V5XSA9IHY7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgY29uc3RydWN0b3JNZXRob2QgPSB2LmRlZmF1bHQgfHwgdjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGluc3RhbmNlID0gbmV3IGNvbnN0cnVjdG9yTWV0aG9kKCk7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlW2luc3RhbmNlLnZhbGlkYXRpb25LZXldID0gaW5zdGFuY2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIHNlbGYuZ2V0VmFsaWRhdG9yID0gZnVuY3Rpb24gKHZhbGlkYXRvcktleSkge1xuICAgICAgICAgICAgaWYgKCEodmFsaWRhdG9yS2V5IGluIGNhY2hlKSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVbdmFsaWRhdG9yS2V5XTtcbiAgICAgICAgfTtcbiAgICB9KCk7XG4gICAgcmVnaXN0cnkucmVnaXN0ZXIuYXBwbHkocmVnaXN0cnksIGluaXRpYWwpO1xuICAgIHJldHVybiByZWdpc3RyeTtcbn1cbmV4cG9ydHMuVmFsaWRhdG9yUmVnaXN0cnkgPSBWYWxSZWdpc3RyeS5hcHBseSh2b2lkIDAsIE9iamVjdC52YWx1ZXMoVmFsaWRhdG9ycykpO1xuZnVuY3Rpb24gdmFsaWRhdGUob2JqKSB7XG4gICAgdmFyIGRlY29yYXRlZFByb3BlcnRpZXMgPSBbXTtcbiAgICBmb3IgKHZhciBwcm9wIGluIG9iailcbiAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShwcm9wKSlcbiAgICAgICAgICAgIGRlY29yYXRlZFByb3BlcnRpZXMucHVzaCh1dGlsc18xLmdldFByb3BlcnR5RGVjb3JhdG9ycyhjb25zdGFudHNfMS5WYWxpZGF0aW9uS2V5cy5SRUZMRUNULCBvYmosIHByb3ApKTtcbiAgICByZXR1cm4gZGVjb3JhdGVkUHJvcGVydGllcy5yZWR1Y2UoZnVuY3Rpb24gKGFjY3VtLCBkZWNvcmF0ZWRQcm9wZXJ0eSkge1xuICAgICAgICB2YXIgcHJvcCA9IGRlY29yYXRlZFByb3BlcnR5LnByb3AsIGRlY29yYXRvcnMgPSBkZWNvcmF0ZWRQcm9wZXJ0eS5kZWNvcmF0b3JzO1xuICAgICAgICBpZiAoIWRlY29yYXRvcnMgfHwgIWRlY29yYXRvcnMubGVuZ3RoKVxuICAgICAgICAgICAgcmV0dXJuIGFjY3VtO1xuICAgICAgICB2YXIgZXJycyA9IGRlY29yYXRvcnMucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGRlY29yYXRvcikge1xuICAgICAgICAgICAgdmFyIHZhbGlkYXRvciA9IGV4cG9ydHMuVmFsaWRhdG9yUmVnaXN0cnkuZ2V0VmFsaWRhdG9yKGRlY29yYXRvci5rZXkpO1xuICAgICAgICAgICAgaWYgKCF2YWxpZGF0b3IpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3QgZmluZCBNYXRjaGluZyB2YWxpZGF0b3IgZm9yIFwiICsgZGVjb3JhdG9yLmtleSArIFwiIGZvciBwcm9wZXJ0eSBcIiArIFN0cmluZyhkZWNvcmF0ZWRQcm9wZXJ0eS5wcm9wKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZXJyID0gdmFsaWRhdG9yLmhhc0Vycm9ycy5hcHBseSh2YWxpZGF0b3IsIF9fc3ByZWFkQXJyYXkoW29ialtwcm9wXV0sIE9iamVjdC52YWx1ZXMoZGVjb3JhdG9yLnByb3BzKSkpO1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIGFjYyA9IGFjYyB8fCB7fTtcbiAgICAgICAgICAgICAgICBhY2NbZGVjb3JhdG9yLmtleV0gPSBlcnI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICB9LCB1bmRlZmluZWQpO1xuICAgICAgICBpZiAoZXJycykge1xuICAgICAgICAgICAgdmFyIHByb3BFcnJvcnMgPSB7XG4gICAgICAgICAgICAgICAgcHJvcGVydHk6IGRlY29yYXRlZFByb3BlcnR5LnByb3AsXG4gICAgICAgICAgICAgICAgZXJyb3JzOiBlcnJzXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYWNjdW0gPSBhY2N1bSB8fCBbXTtcbiAgICAgICAgICAgIGFjY3VtLnB1c2gocHJvcEVycm9ycyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFjY3VtO1xuICAgIH0sIHVuZGVmaW5lZCk7XG59XG5leHBvcnRzLnZhbGlkYXRlID0gdmFsaWRhdGU7IiwiaW1wb3J0IE1vZGVsIGZyb20gXCIuLi9Nb2RlbC9Nb2RlbFwiO1xuaW1wb3J0IHtFcnJvcnMsIFJlZ2lzdHJ5fSBmcm9tIFwiLi90eXBlc1wiO1xuaW1wb3J0IHtnZXRQcm9wZXJ0eURlY29yYXRvcnN9IGZyb20gJy4uL3V0aWxzJ1xuaW1wb3J0ICogYXMgVmFsaWRhdG9ycyBmcm9tICcuL1ZhbGlkYXRvcnMnXG5pbXBvcnQge1ZhbGlkYXRpb25LZXlzfSBmcm9tIFwiLi9jb25zdGFudHNcIjtcbmltcG9ydCBWYWxpZGF0b3IgZnJvbSBcIi4vVmFsaWRhdG9ycy9WYWxpZGF0b3JcIjtcblxuLyoqXG4gKiBSZXR1cm5zXG4gKiBAcmV0dXJuIHsqfVxuICogQGNvbnN0cnVjdG9yXG4gKiBAZnVuY3Rpb24gVmFsUmVnaXN0cnlcbiAqIEBtZW1iZXJPZiBWYWxpZGF0aW9uXG4gKi9cbmZ1bmN0aW9uIFZhbFJlZ2lzdHJ5KC4uLmluaXRpYWw6IGFueVtdKSA6IFJlZ2lzdHJ5IHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgY29uc3QgcmVnaXN0cnk6IFJlZ2lzdHJ5ID0gIG5ldyBmdW5jdGlvbigpe1xuICAgICAgICBjb25zdCBjYWNoZTogYW55ID0ge307XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgY29uc3Qgc2VsZjogYW55ID0gdGhpcztcblxuICAgICAgICAvKipcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHZhbGlkYXRvclxuICAgICAgICAgKiBAbWVtYmVyT2YgVmFsaWRhdG9yUmVnaXN0cnlcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYucmVnaXN0ZXIgPSBmdW5jdGlvbiguLi52YWxpZGF0b3I6IGFueVtdKSA6IHZvaWR7XG4gICAgICAgICAgICB2YWxpZGF0b3IuZm9yRWFjaCh2ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodiBpbnN0YW5jZW9mIFZhbGlkYXRvcil7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlW3YudmFsaWRhdGlvbktleV0gPSB2O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uc3RydWN0b3JNZXRob2QgPSB2LmRlZmF1bHQgfHwgdjtcbiAgICAgICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZTogVmFsaWRhdG9yID0gbmV3IGNvbnN0cnVjdG9yTWV0aG9kKCk7XG4gICAgICAgICAgICAgICAgICAgIGNhY2hlW2luc3RhbmNlLnZhbGlkYXRpb25LZXldID0gaW5zdGFuY2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvKipcbiAgICAgICAgICpcbiAgICAgICAgICogQHBhcmFtIHZhbGlkYXRvcktleVxuICAgICAgICAgKiBAcmV0dXJuIHsqfVxuICAgICAgICAgKiBAbWVtYmVyT2YgVmFsaWRhdG9yUmVnaXN0cnlcbiAgICAgICAgICovXG4gICAgICAgIHNlbGYuZ2V0VmFsaWRhdG9yID0gZnVuY3Rpb24odmFsaWRhdG9yS2V5OiBzdHJpbmcpe1xuICAgICAgICAgICAgaWYgKCEodmFsaWRhdG9yS2V5IGluIGNhY2hlKSlcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVbdmFsaWRhdG9yS2V5XTtcbiAgICAgICAgfVxuICAgIH0oKVxuICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyKC4uLmluaXRpYWwpO1xuICAgIHJldHVybiByZWdpc3RyeTtcbn1cblxuLyoqXG4gKiBAY29uc3RhbnRcbiAqIEBtZW1iZXJPZiBWYWxpZGF0aW9uXG4gKi9cbmV4cG9ydCBjb25zdCBWYWxpZGF0b3JSZWdpc3RyeSA9IFZhbFJlZ2lzdHJ5KC4uLk9iamVjdC52YWx1ZXMoVmFsaWRhdG9ycykpO1xuXG4vKipcbiAqIEFuYWx5c2VzIHRoZSBkZWNvcmF0aW9ucyBvZiB0aGUgcHJvcGVydGllcyBhbmQgdmFsaWRhdGVzIHRoZSBvYmogYWNjb3JkaW5nIHRvIHRoZW1cbiAqIEBmdW5jdGlvbiB2YWxpZGF0ZVxuICogQG1lbWJlck9mIFZhbGlkYXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlPFQgZXh0ZW5kcyBNb2RlbD4ob2JqOiBUKSA6IEVycm9yc3tcbiAgICBjb25zdCBkZWNvcmF0ZWRQcm9wZXJ0aWVzID0gW107XG4gICAgZm9yIChsZXQgcHJvcCBpbiBvYmopXG4gICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkocHJvcCkpXG4gICAgICAgICAgICBkZWNvcmF0ZWRQcm9wZXJ0aWVzLnB1c2goZ2V0UHJvcGVydHlEZWNvcmF0b3JzKFZhbGlkYXRpb25LZXlzLlJFRkxFQ1QsIG9iaiwgcHJvcCkpO1xuXG4gICAgcmV0dXJuIGRlY29yYXRlZFByb3BlcnRpZXMucmVkdWNlKChhY2N1bSwgZGVjb3JhdGVkUHJvcGVydHkpID0+IHtcbiAgICAgICAgY29uc3Qge3Byb3AsIGRlY29yYXRvcnN9ID0gZGVjb3JhdGVkUHJvcGVydHk7XG4gICAgICAgIGlmICghZGVjb3JhdG9ycyB8fCAhZGVjb3JhdG9ycy5sZW5ndGgpXG4gICAgICAgICAgICByZXR1cm4gYWNjdW07XG5cbiAgICAgICAgY29uc3QgZXJycyA9IGRlY29yYXRvcnMucmVkdWNlKChhY2MsIGRlY29yYXRvcjoge2tleTogc3RyaW5nLCBwcm9wczoge319KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB2YWxpZGF0b3IgPSBWYWxpZGF0b3JSZWdpc3RyeS5nZXRWYWxpZGF0b3IoZGVjb3JhdG9yLmtleSk7XG4gICAgICAgICAgICBpZiAoIXZhbGlkYXRvcil7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgZmluZCBNYXRjaGluZyB2YWxpZGF0b3IgZm9yICR7ZGVjb3JhdG9yLmtleX0gZm9yIHByb3BlcnR5ICR7U3RyaW5nKGRlY29yYXRlZFByb3BlcnR5LnByb3ApfWApXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGNvbnN0IGVyciA9IHZhbGlkYXRvci5oYXNFcnJvcnMob2JqW3Byb3BdLCAuLi5PYmplY3QudmFsdWVzKGRlY29yYXRvci5wcm9wcykpO1xuICAgICAgICAgICAgaWYgKGVycil7XG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgIGFjYyA9IGFjYyB8fCB7fTtcbiAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgYWNjW2RlY29yYXRvci5rZXldID0gZXJyO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICB9LCB1bmRlZmluZWQpO1xuXG4gICAgICAgIGlmIChlcnJzKXtcbiAgICAgICAgICAgIGNvbnN0IHByb3BFcnJvcnMgPSB7XG4gICAgICAgICAgICAgICAgcHJvcGVydHk6IGRlY29yYXRlZFByb3BlcnR5LnByb3AsXG4gICAgICAgICAgICAgICAgZXJyb3JzOiBlcnJzXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBhY2N1bSA9IGFjY3VtIHx8IFtdO1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgYWNjdW0ucHVzaChwcm9wRXJyb3JzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhY2N1bTtcbiAgICB9LCB1bmRlZmluZWQpO1xufSJdfQ==
