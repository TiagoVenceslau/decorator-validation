"use strict";

var __spreadArray = this && this.__spreadArray || function (to, from) {
  for (var i = 0, il = from.length, j = to.length; i < il; i++, j++) to[j] = from[i];

  return to;
};

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.isEqual = exports.stringFormat = exports.getPropertyDecorators = void 0;

function getPropertyDecorators(annotationPrefix, target, propertyName) {
  var keys = Reflect.getMetadataKeys(target, propertyName);
  var decorators = keys.filter(function (key) {
    return key.toString().startsWith(annotationPrefix);
  }).reduce(function (values, key) {
    var currValues = {
      key: key.substring(annotationPrefix.length),
      props: Reflect.getMetadata(key, target, propertyName)
    };
    return values.concat(currValues);
  }, []);
  return {
    prop: propertyName,
    decorators: decorators
  };
}

exports.getPropertyDecorators = getPropertyDecorators;

function stringFormat(string) {
  var args = [];

  for (var _i = 1; _i < arguments.length; _i++) {
    args[_i - 1] = arguments[_i];
  }

  return string.replace(/{(\d+)}/g, function (match, number) {
    return typeof args[number] !== 'undefined' ? args[number] : match;
  });
}

exports.stringFormat = stringFormat;

function isEqual(a, b) {
  var propsToIgnore = [];

  for (var _i = 2; _i < arguments.length; _i++) {
    propsToIgnore[_i - 2] = arguments[_i];
  }

  if (a === b) return true;
  if (a instanceof Date && b instanceof Date) return a.getTime() === b.getTime();
  if (!a || !b || typeof a !== 'object' && typeof b !== 'object') return a === b;
  if (a === null || a === undefined || b === null || b === undefined) return false;
  if (a.prototype !== b.prototype) return false;
  var keys = Object.keys(a).filter(function (k) {
    return propsToIgnore.indexOf(k) === -1;
  });
  if (keys.length !== Object.keys(b).filter(function (k) {
    return propsToIgnore.indexOf(k) === -1;
  }).length) return false;
  return keys.every(function (k) {
    return propsToIgnore.indexOf(k) !== -1 || isEqual.apply(void 0, __spreadArray([a[k], b[k]], propsToIgnore));
  });
}

exports.isEqual = isEqual;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLmpzIiwidXRpbHMudHMiXSwibmFtZXMiOlsiX19zcHJlYWRBcnJheSIsInRvIiwiZnJvbSIsImkiLCJpbCIsImxlbmd0aCIsImoiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImlzRXF1YWwiLCJzdHJpbmdGb3JtYXQiLCJnZXRQcm9wZXJ0eURlY29yYXRvcnMiLCJhbm5vdGF0aW9uUHJlZml4IiwidGFyZ2V0IiwicHJvcGVydHlOYW1lIiwia2V5cyIsIlJlZmxlY3QiLCJnZXRNZXRhZGF0YUtleXMiLCJkZWNvcmF0b3JzIiwiZmlsdGVyIiwia2V5IiwidG9TdHJpbmciLCJzdGFydHNXaXRoIiwicmVkdWNlIiwidmFsdWVzIiwiY3VyclZhbHVlcyIsInN1YnN0cmluZyIsInByb3BzIiwiZ2V0TWV0YWRhdGEiLCJjb25jYXQiLCJwcm9wIiwic3RyaW5nIiwiYXJncyIsIl9pIiwiYXJndW1lbnRzIiwicmVwbGFjZSIsIm1hdGNoIiwibnVtYmVyIiwiYSIsImIiLCJwcm9wc1RvSWdub3JlIiwiRGF0ZSIsImdldFRpbWUiLCJ1bmRlZmluZWQiLCJwcm90b3R5cGUiLCJrIiwiaW5kZXhPZiIsImV2ZXJ5IiwiYXBwbHkiXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBLElBQUlBLGFBQWEsR0FBSSxRQUFRLEtBQUtBLGFBQWQsSUFBZ0MsVUFBVUMsRUFBVixFQUFjQyxJQUFkLEVBQW9CO0FBQ3BFLE9BQUssSUFBSUMsQ0FBQyxHQUFHLENBQVIsRUFBV0MsRUFBRSxHQUFHRixJQUFJLENBQUNHLE1BQXJCLEVBQTZCQyxDQUFDLEdBQUdMLEVBQUUsQ0FBQ0ksTUFBekMsRUFBaURGLENBQUMsR0FBR0MsRUFBckQsRUFBeURELENBQUMsSUFBSUcsQ0FBQyxFQUEvRCxFQUNJTCxFQUFFLENBQUNLLENBQUQsQ0FBRixHQUFRSixJQUFJLENBQUNDLENBQUQsQ0FBWjs7QUFDSixTQUFPRixFQUFQO0FBQ0gsQ0FKRDs7QUFLQU0sTUFB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cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19zcHJlYWRBcnJheSA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheSkgfHwgZnVuY3Rpb24gKHRvLCBmcm9tKSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIGlsID0gZnJvbS5sZW5ndGgsIGogPSB0by5sZW5ndGg7IGkgPCBpbDsgaSsrLCBqKyspXG4gICAgICAgIHRvW2pdID0gZnJvbVtpXTtcbiAgICByZXR1cm4gdG87XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5pc0VxdWFsID0gZXhwb3J0cy5zdHJpbmdGb3JtYXQgPSBleHBvcnRzLmdldFByb3BlcnR5RGVjb3JhdG9ycyA9IHZvaWQgMDtcbmZ1bmN0aW9uIGdldFByb3BlcnR5RGVjb3JhdG9ycyhhbm5vdGF0aW9uUHJlZml4LCB0YXJnZXQsIHByb3BlcnR5TmFtZSkge1xuICAgIHZhciBrZXlzID0gUmVmbGVjdC5nZXRNZXRhZGF0YUtleXModGFyZ2V0LCBwcm9wZXJ0eU5hbWUpO1xuICAgIHZhciBkZWNvcmF0b3JzID0ga2V5c1xuICAgICAgICAuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsgcmV0dXJuIGtleS50b1N0cmluZygpLnN0YXJ0c1dpdGgoYW5ub3RhdGlvblByZWZpeCk7IH0pXG4gICAgICAgIC5yZWR1Y2UoZnVuY3Rpb24gKHZhbHVlcywga2V5KSB7XG4gICAgICAgIHZhciBjdXJyVmFsdWVzID0ge1xuICAgICAgICAgICAga2V5OiBrZXkuc3Vic3RyaW5nKGFubm90YXRpb25QcmVmaXgubGVuZ3RoKSxcbiAgICAgICAgICAgIHByb3BzOiBSZWZsZWN0LmdldE1ldGFkYXRhKGtleSwgdGFyZ2V0LCBwcm9wZXJ0eU5hbWUpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB2YWx1ZXMuY29uY2F0KGN1cnJWYWx1ZXMpO1xuICAgIH0sIFtdKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBwcm9wOiBwcm9wZXJ0eU5hbWUsXG4gICAgICAgIGRlY29yYXRvcnM6IGRlY29yYXRvcnNcbiAgICB9O1xufVxuZXhwb3J0cy5nZXRQcm9wZXJ0eURlY29yYXRvcnMgPSBnZXRQcm9wZXJ0eURlY29yYXRvcnM7XG5mdW5jdGlvbiBzdHJpbmdGb3JtYXQoc3RyaW5nKSB7XG4gICAgdmFyIGFyZ3MgPSBbXTtcbiAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICBhcmdzW19pIC0gMV0gPSBhcmd1bWVudHNbX2ldO1xuICAgIH1cbiAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoL3soXFxkKyl9L2csIGZ1bmN0aW9uIChtYXRjaCwgbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiB0eXBlb2YgYXJnc1tudW1iZXJdICE9PSAndW5kZWZpbmVkJ1xuICAgICAgICAgICAgPyBhcmdzW251bWJlcl1cbiAgICAgICAgICAgIDogbWF0Y2g7XG4gICAgfSk7XG59XG5leHBvcnRzLnN0cmluZ0Zvcm1hdCA9IHN0cmluZ0Zvcm1hdDtcbmZ1bmN0aW9uIGlzRXF1YWwoYSwgYikge1xuICAgIHZhciBwcm9wc1RvSWdub3JlID0gW107XG4gICAgZm9yICh2YXIgX2kgPSAyOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgcHJvcHNUb0lnbm9yZVtfaSAtIDJdID0gYXJndW1lbnRzW19pXTtcbiAgICB9XG4gICAgaWYgKGEgPT09IGIpXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIGlmIChhIGluc3RhbmNlb2YgRGF0ZSAmJiBiIGluc3RhbmNlb2YgRGF0ZSlcbiAgICAgICAgcmV0dXJuIGEuZ2V0VGltZSgpID09PSBiLmdldFRpbWUoKTtcbiAgICBpZiAoIWEgfHwgIWIgfHwgKHR5cGVvZiBhICE9PSAnb2JqZWN0JyAmJiB0eXBlb2YgYiAhPT0gJ29iamVjdCcpKVxuICAgICAgICByZXR1cm4gYSA9PT0gYjtcbiAgICBpZiAoYSA9PT0gbnVsbCB8fCBhID09PSB1bmRlZmluZWQgfHwgYiA9PT0gbnVsbCB8fCBiID09PSB1bmRlZmluZWQpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICBpZiAoYS5wcm90b3R5cGUgIT09IGIucHJvdG90eXBlKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhhKS5maWx0ZXIoZnVuY3Rpb24gKGspIHsgcmV0dXJuIHByb3BzVG9JZ25vcmUuaW5kZXhPZihrKSA9PT0gLTE7IH0pO1xuICAgIGlmIChrZXlzLmxlbmd0aCAhPT0gT2JqZWN0LmtleXMoYikuZmlsdGVyKGZ1bmN0aW9uIChrKSB7IHJldHVybiBwcm9wc1RvSWdub3JlLmluZGV4T2YoaykgPT09IC0xOyB9KS5sZW5ndGgpXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4ga2V5cy5ldmVyeShmdW5jdGlvbiAoaykgeyByZXR1cm4gcHJvcHNUb0lnbm9yZS5pbmRleE9mKGspICE9PSAtMSB8fCBpc0VxdWFsLmFwcGx5KHZvaWQgMCwgX19zcHJlYWRBcnJheShbYVtrXSwgYltrXV0sIHByb3BzVG9JZ25vcmUpKTsgfSk7XG59XG5leHBvcnRzLmlzRXF1YWwgPSBpc0VxdWFsOyIsIi8qKlxuICogQG5hbWVzcGFjZSB1dGlsc1xuICogQG1lbWJlck9mIGRlY29yYXRvci12YWxpZGF0aW9uXG4gKi9cblxuLyoqXG4gKiBVdGlsIGZ1bmN0aW9uIHRvIHJldHJpZXZlIHRoZSBkZWNvcmF0b3JzIGZvciB0aGUgcHJvdmlkZWQgUHJvcGVydHlcbiAqXG4gKiBAZnVuY3Rpb24gZ2V0UHJvcGVydHlEZWNvcmF0b3JzXG4gKiBAbWVtYmVyT2YgdXRpbHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFByb3BlcnR5RGVjb3JhdG9ycyhhbm5vdGF0aW9uUHJlZml4OiBzdHJpbmcsIHRhcmdldDogYW55LCBwcm9wZXJ0eU5hbWU6IHN0cmluZyB8IHN5bWJvbCk6IHtwcm9wOiBzdHJpbmcgfCBzeW1ib2wsIGRlY29yYXRvcnM6IFtdfSB7XG4gICAgLy8gZ2V0IGluZm8gYWJvdXQga2V5cyB0aGF0IHVzZWQgaW4gY3VycmVudCBwcm9wZXJ0eVxuICAgIGNvbnN0IGtleXM6IGFueVtdID0gUmVmbGVjdC5nZXRNZXRhZGF0YUtleXModGFyZ2V0LCBwcm9wZXJ0eU5hbWUpO1xuICAgIGNvbnN0IGRlY29yYXRvcnMgPSBrZXlzXG4gICAgICAgIC8vIGZpbHRlciB5b3VyIGN1c3RvbSBkZWNvcmF0b3JzXG4gICAgICAgIC5maWx0ZXIoa2V5ID0+IGtleS50b1N0cmluZygpLnN0YXJ0c1dpdGgoYW5ub3RhdGlvblByZWZpeCkpXG4gICAgICAgIC5yZWR1Y2UoKHZhbHVlcywga2V5KSA9PiB7XG4gICAgICAgICAgICAvLyBnZXQgbWV0YWRhdGEgdmFsdWUuXG4gICAgICAgICAgICBjb25zdCBjdXJyVmFsdWVzID0ge1xuICAgICAgICAgICAgICAgIGtleToga2V5LnN1YnN0cmluZyhhbm5vdGF0aW9uUHJlZml4Lmxlbmd0aCksXG4gICAgICAgICAgICAgICAgcHJvcHM6IFJlZmxlY3QuZ2V0TWV0YWRhdGEoa2V5LCB0YXJnZXQsIHByb3BlcnR5TmFtZSlcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gdmFsdWVzLmNvbmNhdChjdXJyVmFsdWVzKTtcbiAgICAgICAgfSwgW10pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcHJvcDogcHJvcGVydHlOYW1lLFxuICAgICAgICBkZWNvcmF0b3JzOiBkZWNvcmF0b3JzXG4gICAgfTtcbn1cblxuXG5cbi8qKlxuICogVXRpbCBmdW5jdGlvbiB0byBwcm92aWRlIHN0cmluZyBmb3JtYXQgZnVuY3Rpb25hbGl0eSBzaW1pbGFyIHRvIEMjJ3Mgc3RyaW5nLmZvcm1hdFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHJpbmdcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcmdzIHJlcGxhY2VtZW50cyBtYWRlIGJ5IG9yZGVyIG9mIGFwcGVhcmFuY2UgKHJlcGxhY2VtZW50MCB3aWwgcmVwbGFjZSB7MH0gYW5kIHNvIG9uKVxuICogQHJldHVybiB7c3RyaW5nfSBmb3JtYXR0ZWQgc3RyaW5nXG4gKiBAZnVuY3Rpb24gc3RyaW5nRm9ybWF0XG4gKiBAbWVtYmVyT2YgdXRpbHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0cmluZ0Zvcm1hdChzdHJpbmc6IHN0cmluZywgLi4uYXJnczogc3RyaW5nW10pe1xuICAgIHJldHVybiBzdHJpbmcucmVwbGFjZSgveyhcXGQrKX0vZywgZnVuY3Rpb24obWF0Y2gsIG51bWJlcikge1xuICAgICAgICByZXR1cm4gdHlwZW9mIGFyZ3NbbnVtYmVyXSAhPT0gJ3VuZGVmaW5lZCdcbiAgICAgICAgICAgID8gYXJnc1tudW1iZXJdXG4gICAgICAgICAgICA6IG1hdGNoO1xuICAgIH0pO1xufVxuXG4vKipcbiAqIERlZXAgT2JqZWN0IENvbXBhcmlzb25cbiAqIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzMwNDc2MTUwL2phdmFzY3JpcHQtZGVlcC1jb21wYXJpc29uLXJlY3Vyc2l2ZWx5LW9iamVjdHMtYW5kLXByb3BlcnRpZXNcbiAqXG4gKiB3aXRoIG9wdGlvbmFsIGlnbm9yZWQgcHJvcGVydGllc1xuICpcbiAqIEBwYXJhbSB7e319IGFcbiAqIEBwYXJhbSB7e319IGJcbiAqIEBwYXJhbSB7c3RyaW5nfSBbcHJvcHNUb0lnbm9yZV1cbiAqIEByZXR1cm4ge2Jvb2xlYW59XG4gKiBAZnVuY3Rpb24gaXNFcXVhbFxuICogQG1lbWJlck9mIHV0aWxzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0VxdWFsKGE6IGFueSwgYjogYW55LC4uLnByb3BzVG9JZ25vcmU6IHN0cmluZ1tdKTogYm9vbGVhbiB7XG4gICAgaWYgKGEgPT09IGIpIHJldHVybiB0cnVlO1xuICAgIGlmIChhIGluc3RhbmNlb2YgRGF0ZSAmJiBiIGluc3RhbmNlb2YgRGF0ZSkgcmV0dXJuIGEuZ2V0VGltZSgpID09PSBiLmdldFRpbWUoKTtcbiAgICBpZiAoIWEgfHwgIWIgfHwgKHR5cGVvZiBhICE9PSAnb2JqZWN0JyAmJiB0eXBlb2YgYiAhPT0gJ29iamVjdCcpKSByZXR1cm4gYSA9PT0gYjtcbiAgICBpZiAoYSA9PT0gbnVsbCB8fCBhID09PSB1bmRlZmluZWQgfHwgYiA9PT0gbnVsbCB8fCBiID09PSB1bmRlZmluZWQpIHJldHVybiBmYWxzZTtcbiAgICBpZiAoYS5wcm90b3R5cGUgIT09IGIucHJvdG90eXBlKSByZXR1cm4gZmFsc2U7XG4gICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhhKS5maWx0ZXIoayA9PiBwcm9wc1RvSWdub3JlLmluZGV4T2YoaykgPT09IC0xKTtcbiAgICBpZiAoa2V5cy5sZW5ndGggIT09IE9iamVjdC5rZXlzKGIpLmZpbHRlcihrID0+IHByb3BzVG9JZ25vcmUuaW5kZXhPZihrKSA9PT0gLTEpLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiBrZXlzLmV2ZXJ5KGsgPT4gcHJvcHNUb0lnbm9yZS5pbmRleE9mKGspICE9PSAtMSB8fCBpc0VxdWFsKGFba10sIGJba10sIC4uLnByb3BzVG9JZ25vcmUpKTtcbn0iXX0=
